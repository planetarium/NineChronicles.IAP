{% extends "base.html" %}

{% block title %}Product 관리{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Product 관리</h1>

    <!-- Product 목록 테이블 -->
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>이름</th>
                <th>Google SKU</th>
                <th>Apple SKU</th>
                <th>상태</th>
                <th>관리</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.google_sku }}</td>
                <td>{{ product.apple_sku }}</td>
                <td>
                    {% if product.active %}
                        <span class="badge bg-success">✅ 활성</span>
                    {% else %}
                        <span class="badge bg-danger">❌ 비활성</span>
                    {% endif %}
                </td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editProduct('{{ product.id }}', '{{ product.name }}', '{{ product.google_sku }}', '{{ product.apple_sku }}', '{{ product.product_type }}', '{{ product.active|lower }}', '{{ product.discount }}')">✏️ 수정</button>
                    <a href="/products/delete/{{ product.id }}" class="btn btn-danger btn-sm"
                       onclick="return confirm('정말 삭제하시겠습니까?')">🗑 삭제</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- 추가 버튼 -->
    <button class="btn btn-primary mt-3" onclick="showAddForm()">➕ 새 Product 추가</button>

    <!-- Product 추가/수정 폼 -->
    <div id="product-form" class="card shadow p-4 mt-4 d-none">
        <h2 class="mb-4" id="form-title">새 Product 추가</h2>
        
        <form method="post" action="/products/save">
            <input type="hidden" name="id" id="product-id">

            <div class="mb-3">
                <label class="form-label">이름</label>
                <input type="text" name="name" id="product-name" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Google SKU</label>
                <input type="text" name="google_sku" id="product-google-sku" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">Apple SKU</label>
                <input type="text" name="apple_sku" id="product-apple-sku" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">Product 타입</label>
                <input type="text" name="product_type" id="product-type" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">할인율 (%)</label>
                <input type="number" step="0.01" name="discount" id="product-discount" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">활성화</label>
                <div class="form-check">
                    <input type="checkbox" name="active" id="product-active" class="form-check-input">
                    <label class="form-check-label">이 제품 활성화</label>
                </div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success">💾 저장</button>
                <button type="button" class="btn btn-secondary" onclick="hideForm()">취소</button>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript -->
<script>
    function showAddForm() {
        document.getElementById('form-title').innerText = "새 Product 추가";
        document.getElementById('product-id').value = "";
        document.getElementById('product-name').value = "";
        document.getElementById('product-google-sku').value = "";
        document.getElementById('product-apple-sku').value = "";
        document.getElementById('product-type').value = "";
        document.getElementById('product-discount').value = "0";
        document.getElementById('product-active').checked = false;
        document.getElementById('product-form').classList.remove('d-none');
    }

    function editProduct(id, name, googleSku, appleSku, productType, active, discount) {
        document.getElementById('form-title').innerText = "Product 수정";
        document.getElementById('product-id').value = id;
        document.getElementById('product-name').value = name;
        document.getElementById('product-google-sku').value = googleSku;
        document.getElementById('product-apple-sku').value = appleSku;
        document.getElementById('product-type').value = productType;
        document.getElementById('product-discount').value = discount;
        document.getElementById('product-active').checked = active;
        document.getElementById('product-form').classList.remove('d-none');
    }

    function hideForm() {
        document.getElementById('product-form').classList.add('d-none');
    }
</script>
{% endblock %}
